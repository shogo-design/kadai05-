<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>Firebase_version9_RealtimeDB(G'sACADEMYåˆå­¦è€…ç”¨ã‚µãƒ³ãƒ—ãƒ«)</title>
<!-- <style>
    #output{
        height: 500px;
        overflow: scroll;
        border: 2px solid gray;
        border-radius: 10px;
    }
   
    .msg:nth-child(even){
        background: pink;
        width: 40%;
        border-radius: 10px;
        padding: 10px;
    }
    .msg:nth-child(odd){
        width: 40%;
        background:gainsboro;
        margin-left: auto;
        border-radius: 10px;
        padding: 10px;
    }
    .color{
        background: yellow;
    }
</style> -->
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/reset.css">
</head>
<body>

<!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->

<!-- <div>
    <div> åå‰ï¼š<input type="text" id="uname"> </div>
    <div>
        <textarea id="text" cols="30" rows="10"></textarea>
        <button id="send">é€ä¿¡</button>
    </div>
    <div id="output">
    </div>
    </div>
</div> -->
<div id="room">

    <div class="box-left">
        <p class="message-box red" >æ€’ã£ã¦ã‚‹</p>
    </div>

    <div class="box-right">
        <p class="message-box green" >å¬‰ã—ã„</p>
    </div>

    <div class="box-left">
        <p class="message-box yellow">ç–²ã‚ŒãŸ</p>
    </div>
    
    <div class="box-right">
        <p class="message-box blue">æ‚²ã—ã„</p>
    </div>

    <div class="box-left">
        <p class="message-box pink">æ¥½ã—ã„</p>
    </div>



</div>
    
<br />
<input type="radio" name="emotion" class="emotion" id="sad" value="sad" />æ‚²ã—ã„<br />
<input type="radio" name="emotion" class="emotion" id="happy" value="happy" />å¬‰ã—ã„<br />
<input type="radio" name="emotion" class="emotion" id="tired" value="tired" />ç–²ã‚ŒãŸ<br />
<input type="radio" name="emotion" class="emotion" id="good" value="good" />æ¥½ã—ã„<br />
<input type="radio" name="emotion" class="emotion" id="anger" value="anger" />æ€’ã£ã¦ã‚‹<br />
<br />

<div class="input-group chat-input">
    <input id="inputMessage" type="text" class="form-control" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
    <div class="input-group-append">
        <button id="sendBtn" class="btn btn-primary" type="button">é€ä¿¡</button>
    </div>
    <div id="output"></div>
</div>

<!--/ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->



<!-- JQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<!-- JQuery -->


<!--** ä»¥ä¸‹Firebase **-->
<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js";
    import { getDatabase, ref, push, set, onChildAdded, remove, onChildRemoved } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-database.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyALxYlR2pqrx8VsD_qEriweCT4hvkenEuk",
        authDomain: "dev245-57f6c.firebaseapp.com",
        projectId: "dev245-57f6c",
        storageBucket: "dev245-57f6c.appspot.com",
        messagingSenderId: "82160845381",
        appId: "1:82160845381:web:c5c7b14a4f1c396073992c"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);

    const db=getDatabase(app)
    const dbRef=ref(db,'dev245');

    // é€ä¿¡å‡¦ç†ã‚’è¨˜è¿°
    // $('#send').on('click',function(){
    //     // idï¼â€uname"ã®å ´æ‰€ã‚’å–å¾—
    //     const uname=$('#uname').val();
    //     console.log(uname,'aaa')

    //     // id="text"ã®å ´æ‰€ã‚’å–å¾—
    //     const text=$('#text').val();
    //     console.log(text,'ssss')

    //     // alert(uname+text);

    //     const msg = {
    //         uname: uname,
    //         text: text,
    //     }

        // firebaseã«é€ã‚‹æº–å‚™ã‚’ã—ã¦ã„ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ğŸ¤—
        // const newPostRef = push(dbRef) //ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã§ãã‚‹æº–å‚™
        // set(newPostRef, msg); // firebaseã®ç™»éŒ²ã§ãã‚‹å ´æ‰€ã«ä¿å­˜ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ğŸ¤—
        // $('#uname').val("");
        // $('#text').val("");
        // $('#uname').focus();

        // sendé€ä¿¡ã‚¤ãƒ™ãƒ³ãƒˆ ã“ã®ä¸‹ã‚’æ¶ˆã•ãªã„
    // });
    // å—ä¿¡å‡¦ç†ã‚’è¨˜è¿°
        // onChildAdded(dbRef, function (data) {
            // ã“ã“ã‹ã‚‰ãŒå—ä¿¡å‡¦ç†ãŒå§‹ã¾ã‚Šã¾ã™

            // ç™»éŒ²ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™ğŸ¤—
            // const msg = data.val();
            // console.log(msg, 'å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã®å¡Š')
            // const key = data.key;
            // console.log(key, 'ãƒ‡ãƒ¼ã‚¿ã®å¡Šã«ã‚¢ã‚¯ã‚»ã‚¹')
    // es6ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒ†ãƒ©ãƒ«
    // let h = `
    //             <div class="msg">
    //                 <p class="color">${msg.uname}</p>
    //                 <p>${msg.text}</p>
    //             </div>    
    //         `;
            // htmlã«åŸ‹ã‚è¾¼ã¿ã¾ã—ã‚‡ã†ğŸ¤—
            // append();ã¨ã„ã†jqueryã®ãŠã¾ã˜ãªã„ã‚’ä½¿ã„ã¾ã™
//             $("#output").append(h);
//             })
    // *3:é€ä¿¡è€…ãŒè‡ªåˆ†ã‹ã©ã†ã‹ä¿å­˜ã™ã‚‹å¤‰æ•°
    let isMySelf = true;

    // é€ä¿¡ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸæ™‚ã®å‡¦ç†
    $("#sendBtn").on("click", function () {

        // ****firebase********************

        // å…¥åŠ›å€¤ã®å–å¾—
        let messageText = inputMessage.value;
        console.log(messageText);
        

        // å…¥åŠ›å€¤ãŒç©ºã‹ãƒã‚§ãƒƒã‚¯ã™ã‚‹
        if (messageText == '') {
            // å…¥åŠ›å€¤ãŒç©ºã®å ´åˆã€å‡¦ç†ã‚’ä¸­æ–­ã™ã‚‹
            return;
        }

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”¨ã®divã‚’ä½œæˆã™ã‚‹ï¼ˆé–¢æ•°ï¼‰
        let messageBox = createMessageBox();

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”¨ã®divã‚’ä½œæˆã™ã‚‹ï¼ˆé–¢æ•°ï¼‰
        let message = createMessage(messageText);

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”¨ã®divã‚’ä½œæˆã™ã‚‹ï¼ˆé–¢æ•°ï¼‰221120_1618_æ™‚é–“è¿½åŠ 
        let time = createTimeStamp();

        if (isMySelf) {
            // *3:è‡ªåˆ†ãŒé€ä¿¡è€…ã®å ´åˆ
            messageBox.appendChild(time);
            messageBox.appendChild(message);
        } else {
            // *3:ç›¸æ‰‹ãŒé€ä¿¡è€…ã®å ´åˆ
            messageBox.appendChild(message);
            messageBox.appendChild(time);
        }

        // ãƒãƒ£ãƒƒãƒˆç”»é¢ã§ã‚ã‚‹ã€divã‚¿ã‚°ã‚’å–å¾—ã™ã‚‹
        let room = document.getElementById('room');

        // ãƒãƒ£ãƒƒãƒˆç”»é¢ã®divã«æ–°è¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®divã‚’è¿½åŠ ã™ã‚‹
        room.appendChild(messageBox);

        // 221120_1927 æ ¼å¥½æ‚ªã„ãŒã€å·²ã‚€ç„¡ãtimeRecordã‚’å†æ²ç¤ºï¼ˆã©ã†ã‚„ã£ãŸã‚‰functionã®é€”ä¸­çµŒéã‚’æŒã£ã¦ã“ã‚Œã‚‹ã®ã‹ï¼Ÿï¼‰
        //æ›œæ—¥é…åˆ—
        let eMonth = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        let week = ["æ—¥", "æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ"];

        //æ—¥æ™‚å–å¾—
        let now = new Date();            //æ—¥ä»˜å–å¾—æº–å‚™ï¼ˆå¿…é ˆï¼‰ï¼ï¼
        let year = now.getFullYear();    //å¹´
        let month = now.getMonth() + 1;  //æœˆ+ï¼‘ã‚’è¶³ã™
        let date = now.getDate();        //æ—¥
        let day = now.getDay();          //æ›œæ—¥ï¼ˆæ•°å€¤ï¼‰
        let h = now.getHours();          //æ™‚
        let m = now.getMinutes();        //åˆ†
        let s = now.getSeconds();        //ç§’

        //æ—¥æ™‚è¡¨ç¤ºæ–‡å­—åˆ—ã®ä½œæˆ
        let timeRecord = year + "-" + month + "-" + date + "(" + week[day] + ") " + h + ":" + m + ":" + s;

        //firebaseç”¨ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š
        const msg = {
            which: isMySelf, //221120_1832_firebaseã«å‡ºåŠ›ã§ããš
            text: $("#inputMessage").val(),
            time: timeRecord //221120_1832_firebaseã«å‡ºåŠ›ã§ããš

        }
        const newPostRef = push(dbRef); //ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚­ãƒ¼ã‚’ä»˜ã‘ãŸã„
        set(newPostRef, msg);

        //firebaseç”¨ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š

        // å…¥åŠ›æ¬„ã®å…¥åŠ›å€¤ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹
        inputMessage.value = '';

        isMySelf = !isMySelf;

        
        // const txt = $("#inputMessage").val();
        // console.log(txt);
    })

    // ã€ï¼‘ã€‘é–¢æ•°ï¼‘ã¤ç›®ï¼šdivã‚’ä½œæˆã™ã‚‹
    function createMessageBox() {
        // divã‚’ä½œæˆ
        let messageBox = document.createElement('div');
        // console.log(messageBox);

        // *3:èª°ãŒé€ä¿¡è€…ãªã®ã‹ãƒã‚§ãƒƒã‚¯
        if (isMySelf) {
            // *3:è‡ªåˆ†ãŒé€ä¿¡è€…ã®å ´åˆ
            // [box-rightã€ã¨ã„ã†ã‚¯ãƒ©ã‚¹ã‚’divã«è¿½åŠ 
            messageBox.classList.add('box-right');
        } else {
            // *3:ç›¸æ‰‹ãŒé€ä¿¡è€…ã®å ´åˆ
            // [box-leftã€ã¨ã„ã†ã‚¯ãƒ©ã‚¹ã‚’divã«è¿½åŠ 
            messageBox.classList.add('box-left');
        }
        return messageBox
    }

    // ã€ï¼’ã€‘ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”¨ã®pã‚’ä½œæˆã™ã‚‹
    function createMessage(messageText) {
        // pã‚¿ã‚°ã‚’ä½œæˆ
        let message = document.createElement('p');

        // pã‚¿ã‚°ã®ãƒ†ã‚­ã‚¹ãƒˆã«ã€ç”»é¢ã®å…¥åŠ›å€¤ã‚’è¨­å®š
        message.textContent = messageText;

        // pã‚¿ã‚°ã«ã€Œmessage-box]ã¨ã„ã†ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
        message.classList.add('message-box');
        // message-boxã«æ„Ÿæƒ…ã‚’è‰²ã§è¡¨ã™
        let sa = document.getElementById("sad");
        let ha = document.getElementById("happy");
        let ti = document.getElementById("tired");
        let go = document.getElementById("good");
        let an = document.getElementById("anger");

        if(sa){
            message.classList.add('blue');
        }
        if(ha){
            message.classList.add('pink');
        }
        if(ti){
            message.classList.add('yellow');
        }
        if(go){
            message.classList.add('green');
        }
        if(an){
            message.classList.add('red');
        }
        // let globalEmotion;
        // const emotions = document.getElementsByClassName("emotion");
        // for (let i = 0; i < emotions.length; i++) {
        //     if (emotions[i].checked == true) {
        //         console.log(i + 1 + "ç•ªç›®ãŒtrueã§ã—ãŸ");
        //         // globalEmotion = `<p>${emotions[i].value}</p>`;
        //         globalEmotion = emotions[i].value;
        //     }

        //     console.log(globalEmotion);
        //     const v = `
        //         <h1 class="${globalEmotion}">${messageText}</h1>
        //         `;
        //     $("#output").append(v);
        //     // console.log(emotions[i].checked);
        // }
        

        // if (isMySelf) {
        //     // è‡ªåˆ†ãŒé€ä¿¡è€…ã®å ´åˆ
        //     // [green]ã¨ã„ã†ã‚¯ãƒ©ã‚¹ã‚’pã«è¿½åŠ 
        //     message.classList.add('green');
        // } else {
        //     // ã‚ã„ã¦ãŒé€ä¿¡è€…ã®å ´åˆ
        //     // [white]ã¨ã„ã†ã‚¯ãƒ©ã‚¹ã‚’pã«è¿½åŠ 
        //     message.classList.add('white');
        // }
        return message;
    }

    // ã€ï¼“ã€‘ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”¨ã®pã‚’ä½œæˆã™ã‚‹
    function createTimeStamp() {
        //æ›œæ—¥é…åˆ—
        let eMonth = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        let week = ["æ—¥", "æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ"];

        //æ—¥æ™‚å–å¾—
        let now = new Date();            //æ—¥ä»˜å–å¾—æº–å‚™ï¼ˆå¿…é ˆï¼‰ï¼ï¼
        let year = now.getFullYear();    //å¹´
        let month = now.getMonth() + 1;  //æœˆ+ï¼‘ã‚’è¶³ã™
        let date = now.getDate();        //æ—¥
        let day = now.getDay();          //æ›œæ—¥ï¼ˆæ•°å€¤ï¼‰
        let h = now.getHours();          //æ™‚
        let m = now.getMinutes();        //åˆ†
        let s = now.getSeconds();        //ç§’

        //æ—¥æ™‚è¡¨ç¤ºæ–‡å­—åˆ—ã®ä½œæˆ
        let timeRecord = year + "-" + month + "-" + date + "(" + week[day] + ") " + h + ":" + m + ":" + s;
        console.log(timeRecord);
        let timeStamp = document.createElement('p');
        timeStamp.textContent = timeRecord;

        // *3:èª°ãŒé€ä¿¡è€…ãªã®ã‹ãƒã‚§ãƒƒã‚¯
        if (isMySelf) {
            // *3:è‡ªåˆ†ãŒé€ä¿¡è€…ã®å ´åˆ
            // [box-rightã€ã¨ã„ã†ã‚¯ãƒ©ã‚¹ã‚’divã«è¿½åŠ 
            timeStamp.classList.add('box-right-time');
        } else {
            // *3:ç›¸æ‰‹ãŒé€ä¿¡è€…ã®å ´åˆ
            // [box-leftã€ã¨ã„ã†ã‚¯ãƒ©ã‚¹ã‚’divã«è¿½åŠ 
            timeStamp.classList.add('box-left-time');
        }
        // timeStamp.classList.add('time');
        console.log(timeStamp);

        return timeStamp;

    }
// </script>











</body>
</html>
































